<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vale Mansion Murder Mystery</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --primary-dark: #0f0f0f;
  --accent-gold: #d4af37;
  --accent-blood: #8b0000;
  --text-light: #e8e6e3;
  --text-dim: #9a9a9a;
  --border-glow: rgba(212, 175, 55, 0.3);
}

body { 
  font-family: 'Crimson Text', serif; 
  color: var(--text-light); 
  background: var(--primary-dark); 
  overflow: hidden; 
  height: 100vh; 
}

#game-container { 
  display: flex; 
  height: 100vh; 
  position: relative; 
}

#game-container::before { 
  content: ''; 
  position: absolute; 
  width: 100%; 
  height: 100%; 
  background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.4) 100%); 
  pointer-events: none; 
  z-index: 1; 
}

#sidebar { 
  width: 340px; 
  background: linear-gradient(180deg, rgba(20,20,20,0.98) 0%, rgba(10,10,10,0.98) 100%); 
  border-right: 2px solid var(--accent-gold); 
  box-shadow: 4px 0 20px rgba(0,0,0,0.8); 
  overflow-y: auto; 
  z-index: 10; 
  display: flex; 
  flex-direction: column; 
}

#sidebar::-webkit-scrollbar { width: 8px; }
#sidebar::-webkit-scrollbar-thumb { background: var(--accent-gold); border-radius: 4px; }

.mansion-header { 
  background: linear-gradient(180deg, var(--accent-blood) 0%, #4a0000 100%); 
  padding: 25px 20px; 
  text-align: center; 
  border-bottom: 3px solid var(--accent-gold); 
}

.mansion-header h1 { 
  font-family: 'Cinzel', serif; 
  font-size: 24px; 
  font-weight: 700; 
  letter-spacing: 3px; 
  text-transform: uppercase; 
  margin-bottom: 8px; 
  color: var(--accent-gold); 
}

.sidebar-section { 
  margin: 20px 15px; 
  padding: 15px; 
  background: rgba(30,30,30,0.6); 
  border: 1px solid rgba(212, 175, 55, 0.2); 
  border-radius: 8px; 
}

.sidebar-section h3 { 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  font-weight: 600; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 2px; 
  margin-bottom: 12px; 
  border-bottom: 1px solid rgba(212, 175, 55, 0.3); 
  padding-bottom: 8px; 
}

.clue-item { 
  display: flex; 
  align-items: center; 
  margin: 8px 0; 
  padding: 8px; 
  background: rgba(20,20,20,0.8); 
  border-left: 3px solid var(--accent-gold); 
  border-radius: 4px; 
  font-size: 12px; 
}

.clue-icon { 
  margin-right: 8px; 
  font-size: 16px; 
  flex-shrink: 0; 
}

.clue-text { 
  color: var(--text-dim); 
}

.suspects-grid { 
  display: grid; 
  grid-template-columns: repeat(2, 1fr); 
  gap: 8px; 
}

.suspect-card { 
  background: rgba(20,20,20,0.9); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 8px; 
  padding: 10px; 
  text-align: center; 
  cursor: pointer; 
  transition: all 0.3s ease; 
}

.suspect-card:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 15px var(--border-glow); 
}

.suspect-portrait { 
  width: 50px; 
  height: 50px; 
  border-radius: 50%; 
  border: 2px solid var(--accent-gold); 
  margin: 0 auto 8px; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 28px; 
}

.suspect-name { 
  font-family: 'Cinzel', serif; 
  font-size: 10px; 
  font-weight: 600; 
  color: var(--accent-gold); 
  margin-bottom: 2px; 
}

.suspect-role { 
  font-size: 9px; 
  color: var(--text-dim); 
  font-style: italic; 
}

.room-buttons { 
  display: grid; 
  grid-template-columns: repeat(2, 1fr); 
  gap: 8px; 
}

.room-btn, .action-btn { 
  padding: 11px; 
  background: rgba(40,40,40,0.9); 
  color: var(--text-light); 
  border: 1px solid rgba(212, 175, 55, 0.3); 
  border-radius: 6px; 
  font-family: 'Crimson Text', serif; 
  font-size: 12px; 
  font-weight: 600; 
  cursor: pointer; 
  transition: all 0.3s ease; 
  text-transform: uppercase; 
}

.room-btn:hover, .action-btn:hover { 
  background: rgba(60,60,60,0.9); 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 15px var(--border-glow); 
}

.action-btn { 
  grid-column: span 2; 
  background: linear-gradient(180deg, rgba(139,0,0,0.3) 0%, rgba(70,0,0,0.3) 100%); 
}

#main-panel { 
  flex: 1; 
  position: relative; 
  background-size: cover; 
  background-position: center; 
  overflow: hidden; 
}

#main-panel::after { 
  content: ''; 
  position: absolute; 
  inset: 0; 
  background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.7) 100%); 
  pointer-events: none; 
}

.room-header { 
  position: absolute; 
  top: 30px; 
  left: 50%; 
  transform: translateX(-50%); 
  z-index: 5; 
  background: rgba(10,10,10,0.85); 
  padding: 15px 40px; 
  border: 2px solid var(--accent-gold); 
  border-radius: 10px; 
}

.room-header h2 { 
  font-family: 'Cinzel', serif; 
  font-size: 28px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 4px; 
}

#room-items { 
  position: absolute; 
  bottom: 240px; 
  left: 50%; 
  transform: translateX(-50%); 
  display: flex; 
  gap: 15px; 
  z-index: 5; 
  max-width: 90%; 
  flex-wrap: wrap; 
  justify-content: center; 
  padding: 20px; 
}

.item-card { 
  background: rgba(10,10,10,0.9); 
  border: 2px solid rgba(212, 175, 55, 0.4); 
  border-radius: 12px; 
  padding: 15px; 
  cursor: pointer; 
  transition: all 0.4s ease; 
  box-shadow: 0 4px 15px rgba(0,0,0,0.7); 
  min-width: 100px; 
  max-width: 120px; 
  animation: itemFadeIn 0.6s ease backwards; 
}

@keyframes itemFadeIn { 
  from { opacity: 0; transform: translateY(20px) scale(0.9); } 
  to { opacity: 1; transform: translateY(0) scale(1); } 
}

.item-card:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 25px var(--border-glow); 
  transform: translateY(-8px) scale(1.05); 
}

.item-icon { 
  font-size: 48px; 
  margin-bottom: 8px; 
}

.item-label { 
  font-family: 'Cinzel', serif; 
  font-size: 12px; 
  color: var(--accent-gold); 
  text-align: center; 
  text-transform: uppercase; 
}

#dialogue-box { 
  position: absolute; 
  bottom: 20px; 
  left: 20px; 
  right: 20px; 
  max-height: 180px; 
  background: rgba(10,10,10,0.95); 
  border: 2px solid var(--accent-gold); 
  border-radius: 12px; 
  padding: 20px; 
  overflow-y: auto; 
  font-size: 13px; 
  z-index: 5; 
}

#dialogue-box::-webkit-scrollbar-thumb { 
  background: var(--accent-gold); 
}

.dialogue-line { 
  margin-bottom: 10px; 
  padding-left: 20px; 
  position: relative; 
}

.dialogue-line::before { 
  content: '‚ñ∫'; 
  position: absolute; 
  left: 0; 
  color: var(--accent-gold); 
}

.clue-found { 
  color: var(--accent-gold); 
  font-weight: 600; 
}

.witness-note { 
  color: #7dd3fc; 
  font-weight: 600; 
}

.contradiction-note { 
  color: #ff6b6b; 
  font-weight: 600; 
}

.modal { 
  display: none; 
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%); 
  width: 600px; 
  max-width: 90%; 
  max-height: 90vh; 
  background: linear-gradient(180deg, rgba(20,20,20,0.98) 0%, rgba(10,10,10,0.98) 100%); 
  border: 3px solid var(--accent-gold); 
  border-radius: 15px; 
  padding: 30px; 
  z-index: 100; 
  box-shadow: 0 0 50px rgba(0,0,0,0.9); 
  overflow-y: auto; 
}

.modal h2 { 
  font-family: 'Cinzel', serif; 
  font-size: 26px; 
  color: var(--accent-gold); 
  text-align: center; 
  text-transform: uppercase; 
  letter-spacing: 3px; 
  margin-bottom: 25px; 
}

.modal h3 { 
  font-family: 'Cinzel', serif; 
  font-size: 16px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 2px; 
  margin-bottom: 15px; 
  margin-top: 15px; 
}

.selection-grid { 
  display: grid; 
  grid-template-columns: repeat(3, 1fr); 
  gap: 12px; 
}

.selection-item { 
  background: rgba(30,30,30,0.8); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 10px; 
  padding: 15px; 
  cursor: pointer; 
  text-align: center; 
  transition: all 0.3s ease; 
  position: relative; 
}

.selection-item:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 20px var(--border-glow); 
  transform: scale(1.05); 
}

.selection-item.selected { 
  border-color: var(--accent-gold); 
  background: rgba(212,175,55,0.2); 
}

.selection-item.selected::after { 
  content: '‚úì'; 
  position: absolute; 
  top: 5px; 
  right: 5px; 
  color: var(--accent-gold); 
  font-size: 20px; 
}

.selection-icon { 
  font-size: 40px; 
  margin-bottom: 8px; 
}

.selection-label { 
  font-size: 12px; 
  color: var(--text-light); 
  text-transform: uppercase; 
}

.modal-buttons { 
  display: flex; 
  gap: 15px; 
  margin-top: 25px; 
}

.modal-btn { 
  flex: 1; 
  padding: 15px; 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  font-weight: 600; 
  text-transform: uppercase; 
  border: 2px solid var(--accent-gold); 
  border-radius: 8px; 
  cursor: pointer; 
  transition: all 0.3s ease; 
}

.modal-btn-primary { 
  background: rgba(139,0,0,0.8); 
  color: var(--text-light); 
}

.modal-btn-primary:hover { 
  background: rgba(139,0,0,1); 
  box-shadow: 0 0 20px rgba(139,0,0,0.6); 
}

.modal-btn-secondary { 
  background: rgba(40,40,40,0.8); 
  color: var(--text-light); 
}

.modal-btn-secondary:hover { 
  background: rgba(60,60,60,0.9); 
}

.clue-popup { 
  display: none; 
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%) scale(0.8); 
  background: linear-gradient(180deg, rgba(20,20,20,0.98) 0%, rgba(10,10,10,0.98) 100%); 
  border: 3px solid var(--accent-gold); 
  border-radius: 15px; 
  padding: 30px; 
  max-width: 500px; 
  z-index: 150; 
  box-shadow: 0 0 50px rgba(212,175,55,0.6); 
  opacity: 0; 
  pointer-events: none; 
  transition: all 0.5s ease; 
}

.clue-popup.show { 
  opacity: 1; 
  display: block; 
  transform: translate(-50%, -50%) scale(1); 
  pointer-events: all; 
}

.clue-popup-icon { 
  font-size: 60px; 
  margin-bottom: 15px; 
  text-align: center;
}

.clue-popup-title { 
  font-family: 'Cinzel', serif; 
  font-size: 24px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 3px; 
  margin-bottom: 10px; 
  text-align: center;
}

.clue-popup-description { 
  font-size: 16px; 
  line-height: 1.8; 
  color: var(--text-light); 
  margin-bottom: 20px; 
  padding: 15px; 
  background: rgba(30,30,30,0.8); 
  border-left: 4px solid var(--accent-gold); 
  border-radius: 5px; 
}

.clue-popup-btn { 
  width: 100%; 
  padding: 15px; 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  font-weight: 600; 
  text-transform: uppercase; 
  background: rgba(139,0,0,0.8); 
  color: var(--text-light); 
  border: 2px solid var(--accent-gold); 
  border-radius: 8px; 
  cursor: pointer; 
}

.clue-popup-btn:hover { 
  background: rgba(139,0,0,1); 
}

.interrogation-header { 
  text-align: center; 
  margin-bottom: 25px; 
}

.interrogation-portrait { 
  width: 100px; 
  height: 100px; 
  border-radius: 50%; 
  border: 3px solid var(--accent-gold); 
  margin: 0 auto 15px; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 60px; 
  background: rgba(30,30,30,0.8); 
}

.interrogation-name { 
  font-family: 'Cinzel', serif; 
  font-size: 22px; 
  color: var(--accent-gold); 
  margin-bottom: 5px; 
}

.interrogation-role { 
  font-size: 14px; 
  color: var(--text-dim); 
  font-style: italic; 
}

.question-btn { 
  width: 100%; 
  padding: 15px; 
  margin-bottom: 10px; 
  background: rgba(30,30,30,0.8); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 8px; 
  color: var(--text-light); 
  font-family: 'Crimson Text', serif; 
  font-size: 14px; 
  text-align: left; 
  cursor: pointer; 
  transition: all 0.3s ease; 
}

.question-btn:hover { 
  background: rgba(40,40,40,0.9); 
  border-color: var(--accent-gold); 
}

.response-box { 
  margin: 20px 0; 
  padding: 15px; 
  background: rgba(10,10,10,0.9); 
  border-left: 4px solid var(--accent-gold); 
  border-radius: 6px; 
  min-height: 60px; 
  font-style: italic; 
  color: var(--text-dim); 
  max-height: 150px; 
  overflow-y: auto; 
}

.autopsy-section { 
  background: rgba(30,30,30,0.8); 
  border-left: 4px solid var(--accent-blood); 
  padding: 15px; 
  margin-bottom: 15px; 
  border-radius: 8px; 
}

.autopsy-section h4 { 
  color: var(--accent-blood); 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  margin-bottom: 10px; 
  text-transform: uppercase; 
}

.autopsy-content { 
  font-size: 13px; 
  line-height: 1.6; 
  color: var(--text-light); 
}

.alibi-card { 
  background: rgba(30,30,30,0.8); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 10px; 
  padding: 15px; 
  transition: all 0.3s ease; 
  margin-bottom: 15px; 
  cursor: pointer; 
}

.alibi-card:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 15px var(--border-glow); 
}

.alibi-card h4 { 
  color: var(--accent-gold); 
  font-family: 'Cinzel', serif; 
  margin-bottom: 8px; 
  font-size: 14px; 
}

.alibi-item { 
  font-size: 12px; 
  color: var(--text-dim); 
  margin: 5px 0; 
}

.alibi-verified { 
  color: #2d7d2d; 
  font-weight: 600; 
}

.alibi-suspicious { 
  color: #ff6b6b; 
  font-weight: 600; 
}

.intro-screen { 
  position: fixed; 
  inset: 0; 
  background: linear-gradient(180deg, #0a0a0a 0%, #1a1a1a 100%); 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  justify-content: center; 
  z-index: 1000; 
  padding: 40px; 
  overflow-y: auto; 
}

.intro-content { 
  max-width: 800px; 
  text-align: center; 
}

.intro-title { 
  font-family: 'Cinzel', serif; 
  font-size: 56px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 8px; 
  margin-bottom: 15px; 
  text-shadow: 0 0 30px var(--accent-gold);
}

.intro-subtitle { 
  font-size: 20px; 
  color: var(--accent-blood); 
  font-style: italic; 
  margin-bottom: 40px; 
}

.intro-story { 
  background: rgba(20,20,20,0.8); 
  border: 2px solid var(--accent-gold); 
  border-radius: 15px; 
  padding: 30px; 
  margin-bottom: 40px; 
}

.intro-story h2 { 
  font-family: 'Cinzel', serif; 
  font-size: 24px; 
  color: var(--accent-gold); 
  margin-bottom: 20px; 
  text-transform: uppercase; 
}

.intro-story p { 
  font-size: 16px; 
  line-height: 1.8; 
  color: var(--text-light); 
  margin-bottom: 15px; 
  text-align: left; 
}

.victim-box { 
  background: rgba(139,0,0,0.2); 
  border-left: 4px solid var(--accent-blood); 
  padding: 15px; 
  margin: 20px 0; 
  border-radius: 5px; 
}

.start-button { 
  padding: 20px 60px; 
  font-family: 'Cinzel', serif; 
  font-size: 20px; 
  font-weight: 700; 
  text-transform: uppercase; 
  background: rgba(139,0,0,0.9); 
  color: var(--text-light); 
  border: 3px solid var(--accent-gold); 
  border-radius: 10px; 
  cursor: pointer; 
  transition: all 0.4s ease; 
}

.start-button:hover { 
  background: rgba(139,0,0,1); 
  box-shadow: 0 0 50px rgba(212,175,55,0.8); 
  transform: translateY(-5px); 
}
</style>
</head>
<body>

<div id="intro-screen" class="intro-screen">
  <div class="intro-content">
    <div class="intro-title">Vale Mansion</div>
    <div class="intro-subtitle">A Murder Most Foul</div>
    
    <div class="intro-story">
      <h2>The Case</h2>
      <p>On a cold October evening in 1924, Vale Mansion was shaken by a terrible crime. The renowned industrialist <strong>REGINALD VALE</strong> was found dead in his study.</p>
      <div class="victim-box">
        <strong>VICTIM:</strong> Reginald Vale, aged 58<br>
        <strong>TIME:</strong> Between 8:00 PM and 10:00 PM<br>
        <strong>LOCATION:</strong> The Study
      </div>
      <p>Six individuals were present. Each has secrets. Your task: identify the killer, weapon, and motive through logical deduction and puzzle solving.</p>
    </div>
    
    <button class="start-button" onclick="startGame()">BEGIN INVESTIGATION</button>
  </div>
</div>

<div id="game-container" style="display:none;">
  <div id="sidebar">
    <div class="mansion-header">
      <h1>Vale Mansion</h1>
    </div>
    
    <div class="sidebar-section">
      <h3>üìã Evidence <span class="evidence-count">(0)</span></h3>
      <div id="inventory-list"></div>
    </div>
    
    <div class="sidebar-section">
      <h3>üîç Suspects</h3>
      <div id="suspects-list" class="suspects-grid"></div>
    </div>
    
    <div class="sidebar-section">
      <h3>üö™ Rooms</h3>
      <div class="room-buttons">
        <button class="room-btn" onclick="moveRoom('study')">Study</button>
        <button class="room-btn" onclick="moveRoom('kitchen')">Kitchen</button>
        <button class="room-btn" onclick="moveRoom('conservatory')">Conservatory</button>
        <button class="room-btn" onclick="moveRoom('office')">Office</button>
        <button class="room-btn" onclick="moveRoom('guest')">Guest</button>
        <button class="room-btn" onclick="moveRoom('library')">Library</button>
      </div>
    </div>
    
    <div class="sidebar-section">
      <h3>‚ö° Actions</h3>
      <button class="action-btn" onclick="showSuspectsInRoom()">üó£Ô∏è Interrogate</button>
      <button class="action-btn" onclick="openAlibiBoard()">üìã Alibis</button>
      <button class="action-btn" onclick="openAutopsyReport()">‚öïÔ∏è Autopsy</button>
      <button class="action-btn" onclick="getHint()">üí° Hint</button>
      <button class="action-btn" onclick="openAccusationModal()">‚öñÔ∏è Accuse</button>
    </div>
  </div>
  
  <div id="main-panel">
    <div class="room-header">
      <h2 id="room-title">Study</h2>
    </div>
    <div id="room-items"></div>
    <div id="dialogue-box"></div>
  </div>
</div>

<div id="clue-popup" class="clue-popup">
  <div class="clue-popup-icon" id="clue-popup-icon">üîç</div>
  <div class="clue-popup-title">Evidence Found!</div>
  <div class="clue-popup-description" id="clue-popup-description"></div>
  <button class="clue-popup-btn" onclick="closeCluePopup()">Add to Evidence</button>
</div>

<div id="accusation-modal" class="modal">
  <h2>Make Your Accusation</h2>
  <div class="modal-section">
    <h3>Select Suspect</h3>
    <div id="acc-suspects" class="selection-grid"></div>
  </div>
  <div class="modal-section">
    <h3>Select Weapon</h3>
    <div id="acc-weapons" class="selection-grid"></div>
  </div>
  <div class="modal-section">
    <h3>Select Motive</h3>
    <div id="acc-motives" class="selection-grid"></div>
  </div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-primary" onclick="submitAccusation()">Submit</button>
    <button class="modal-btn modal-btn-secondary" onclick="closeAccusationModal()">Cancel</button>
  </div>
</div>

<div id="interrogation-modal" class="modal">
  <div class="interrogation-header">
    <div class="interrogation-portrait" id="interrog-portrait"></div>
    <div class="interrogation-name" id="interrog-name"></div>
    <div class="interrogation-role" id="interrog-role"></div>
  </div>
  <div id="question-list"></div>
  <div class="response-box" id="response-box">Ask a question to begin...</div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-secondary" onclick="closeInterrogationModal()">End</button>
  </div>
</div>

<div id="autopsy-modal" class="modal">
  <h2>üî¨ Autopsy Report</h2>
  <div class="autopsy-section">
    <h4>Wound Analysis</h4>
    <div class="autopsy-content" id="wound-analysis"></div>
  </div>
  <div class="autopsy-section">
    <h4>Time of Death</h4>
    <div class="autopsy-content" id="time-of-death"></div>
  </div>
  <div class="autopsy-section">
    <h4>Chemical Analysis</h4>
    <div class="autopsy-content" id="chemical-analysis"></div>
  </div>
  <div class="autopsy-section">
    <h4>Findings</h4>
    <div class="autopsy-content" id="additional-findings"></div>
  </div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-secondary" onclick="closeAutopsyReport()">Close</button>
  </div>
</div>

<div id="alibi-modal" class="modal">
  <h2>üìã Alibi Board</h2>
  <div id="alibi-board-content"></div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-secondary" onclick="closeAlibiBoard()">Close</button>
  </div>
</div>

<script>
const SUSPECTS = {
  trevor: {name: "TREVOR VALE", role: "Brother", room: "kitchen", portrait: "üë®‚Äçüíº", bg: "Desperate for inheritance. Written out of will."},
  emma: {name: "EMMA HARROW", role: "Assistant", room: "conservatory", portrait: "üë©‚Äçüíº", bg: "Personal assistant. Knows all secrets."},
  lyle: {name: "DR. ARTHUR LYLE", role: "Physician", room: "guest", portrait: "üë®‚Äç‚öïÔ∏è", bg: "Family doctor. Owed Reginald money."},
  marcus: {name: "MARCUS FINCH", role: "Courier", room: "office", portrait: "üë®‚Äç‚úàÔ∏è", bg: "Delivered documents. Transporting valuables."},
  vanessa: {name: "VANESSA CROSS", role: "Neighbor", room: "library", portrait: "üë©‚Äçü¶∞", bg: "Property dispute. Bitter relationship."},
  gerald: {name: "GERALD STONE", role: "Lawyer", room: "study", portrait: "üë®‚Äç‚öñÔ∏è", bg: "Changed will recently. Legal advisor."}
};

const WEAPONS = [{name: "knife", icon: "üî™", label: "Knife"}, {name: "poison", icon: "‚ò†Ô∏è", label: "Poison"}, {name: "rope", icon: "ü™¢", label: "Rope"}, {name: "candlestick", icon: "üïØÔ∏è", label: "Candlestick"}, {name: "gun", icon: "üî´", label: "Gun"}];

const MOTIVES = [{name: "money", icon: "üí∞", label: "Money"}, {name: "revenge", icon: "‚öîÔ∏è", label: "Revenge"}, {name: "jealousy", icon: "üíî", label: "Jealousy"}, {name: "coverup", icon: "ü§´", label: "Cover-up"}, {name: "greed", icon: "üíé", label: "Greed"}];

const AUTOPSY_DATA = {
  knife: {wound: "Long incision, sharp edges. Defensive wounds on hands.", time: "8:45-9:15 PM", chemical: "Iron traces. No toxins.", findings: "Severe struggle. Victim fought back."},
  poison: {wound: "No external wounds. Blue lips, constricted pupils.", time: "Around 9:30 PM", chemical: "Cyanide detected. Bitter almond odor.", findings: "Foam around mouth. No struggle."},
  rope: {wound: "Ligature marks around neck. Severe bruising.", time: "Around 9:00 PM", chemical: "Rope fibers under fingernails.", findings: "Prolonged struggle evidence."},
  candlestick: {wound: "Blunt force trauma. Fractured skull.", time: "Around 8:50 PM", chemical: "No toxins. Blood type matches.", findings: "Silver dust in wound. Single blow."},
  gun: {wound: "Gunshot to chest. Bullet near heart.", time: "Around 8:30 PM", chemical: "Gunpowder residue present.", findings: "Close range. Silent killer."}
};

let MURDER_SOLUTION = (() => {
  const suspects = Object.keys(SUSPECTS);
  const weaponNames = WEAPONS.map(w => w.name);
  const motiveNames = MOTIVES.map(m => m.name);
  return {killer: suspects[Math.floor(Math.random() * suspects.length)], weapon: weaponNames[Math.floor(Math.random() * weaponNames.length)], motive: motiveNames[Math.floor(Math.random() * motiveNames.length)]};
})();

let currentRoom = "study", clueInventory = {}, guessAttempts = 0, hintsUsed = 0;

function addDialogue(text, type = 'normal') {
  const box = document.getElementById("dialogue-box");
  const line = document.createElement("div");
  line.className = "dialogue-line";
  if (type === 'clue') line.innerHTML = `<span class="clue-found">${text}</span>`;
  else if (type === 'witness') line.innerHTML = `<span class="witness-note">${text}</span>`;
  else if (type === 'contradiction') line.innerHTML = `<span class="contradiction-note">${text}</span>`;
  else line.innerText = text;
  box.appendChild(line);
  box.scrollTop = box.scrollHeight;
}

function showRoom() {
  document.getElementById("room-title").innerText = currentRoom.charAt(0).toUpperCase() + currentRoom.slice(1);
  const container = document.getElementById("room-items");
  container.innerHTML = "";
  const items = generateRoomItems(currentRoom);
  items.forEach((item, i) => {
    const card = document.createElement("div");
    card.className = "item-card";
    card.style.animationDelay = (i * 0.1) + "s";
    card.innerHTML = `<div class="item-icon">${item.icon}</div><div class="item-label">${item.name}</div>`;
    card.onclick = () => inspectItem(item);
    container.appendChild(card);
  });
  updateSidebar();
}

function generateRoomItems(room) {
  const killer = MURDER_SOLUTION.killer;
  const weapon = MURDER_SOLUTION.weapon;
  const motive = MURDER_SOLUTION.motive;
  const items = {
    study: [
      {id: "letter", name: "Locked Drawer", icon: "üîí", text: `Letter to ${SUSPECTS[killer].name} about ${motive}.`, puzzle: true},
      {id: "phone", name: "Phone Log", icon: "‚òéÔ∏è", text: "Call to suspect at 8:45 PM.", puzzle: false},
      {id: "blood", name: "Blood Stains", icon: "ü©∏", text: "Fresh blood on desk.", puzzle: false}
    ],
    kitchen: [
      {id: "weapon", name: weapon === "knife" ? "Missing Knife" : "Evidence", icon: weapon === "knife" ? "üî™" : "üì¶", text: `${weapon} evidence found.`, puzzle: true},
      {id: "note", name: "Handwritten Note", icon: "üìù", text: `${SUSPECTS[killer].name}'s note about ${motive}.`, puzzle: false},
      {id: "cleanup", name: "Cleanup Traces", icon: "üö∞", text: "Blood in sink. Recently cleaned.", puzzle: false}
    ],
    conservatory: [
      {id: "diary", name: "Diary Entry", icon: "üìî", text: `Witness saw ${SUSPECTS[killer].name} acting suspicious.`, puzzle: true},
      {id: "items", name: "Personal Items", icon: "‚òï", text: `${SUSPECTS[killer].name}'s belongings showing distress.`, puzzle: false},
      {id: "haste", name: "Haste Signs", icon: "üßµ", text: `Evidence of rushed departure.`, puzzle: false}
    ],
    office: [
      {id: "financial", name: "Safe Records", icon: "üîê", text: `${SUSPECTS[killer].name}'s motive: ${motive}.`, puzzle: true},
      {id: "will", name: "Will Changes", icon: "üìú", text: "Will changed today. Affects killer.", puzzle: false},
      {id: "valuables", name: "Valuables", icon: "üíé", text: "Large cash sum found.", puzzle: false}
    ],
    guest: [
      {id: "suitcase", name: "Packed Suitcase", icon: "üß≥", text: `${SUSPECTS[killer].name}'s hasty escape.`, puzzle: true},
      {id: "ticket", name: "Travel Booking", icon: "üé´", text: "Departure booked for same night.", puzzle: false},
      {id: "escape", name: "Escape Plan", icon: "üëú", text: "Premeditated escape evident.", puzzle: false}
    ],
    library: [
      {id: "message", name: "Hidden Message", icon: "üìö", text: `Book with coded ${weapon} reference.`, puzzle: true},
      {id: "contradiction", name: "Contradiction", icon: "üìÆ", text: `${SUSPECTS[killer].name}'s alibi contradicted.`, puzzle: false},
      {id: "link", name: "Murder Link", icon: "üîç", text: `Object linked to ${SUSPECTS[killer].name}.`, puzzle: false}
    ]
  };
  return items[room] || [];
}

function moveRoom(room) {
  currentRoom = room;
  addDialogue(`You move to the ${room}.`);
  showRoom();
}

function inspectItem(item) {
  addDialogue(`You examine ${item.name}...`);
  if (!clueInventory[item.id]) {
    if (item.puzzle) {
      const puzzle = {
        study: {q: "Code: Month(10) + Year(24) + Suspects(06)", a: "102406"},
        kitchen: {q: `What's missing? Answer: ${MURDER_SOLUTION.weapon}`, a: MURDER_SOLUTION.weapon},
        conservatory: {q: `Diary: Saw ___ looking ___. Answer: ${SUSPECTS[MURDER_SOLUTION.killer].name.split(' ')[0].toLowerCase()}`, a: SUSPECTS[MURDER_SOLUTION.killer].name.split(' ')[0].toLowerCase()},
        office: {q: "Safe pattern O-4-7-?. Answer: 3", a: "3"},
        guest: {q: "Days before? Today=15, Ticket=16. Answer: D1", a: "d1"},
        library: {q: `Message applies to initials. Answer: ${MURDER_SOLUTION.killer.charAt(0).toUpperCase()}`, a: MURDER_SOLUTION.killer.charAt(0).toLowerCase()}
      }[currentRoom];
      const answer = prompt(puzzle.q);
      if (answer && answer.toLowerCase() === puzzle.a.toLowerCase()) {
        clueInventory[item.id] = item;
        addDialogue("‚úì Puzzle solved!", 'clue');
        showCluePopup(item);
        updateSidebar();
      } else if (answer) {
        addDialogue("‚úó Incorrect.", 'contradiction');
      }
    } else {
      clueInventory[item.id] = item;
      showCluePopup(item);
      updateSidebar();
    }
  } else {
    addDialogue("Already found this clue.");
  }
}

function showCluePopup(item) {
  const popup = document.getElementById("clue-popup");
  document.getElementById("clue-popup-icon").innerText = item.icon;
  document.getElementById("clue-popup-description").innerText = item.text;
  popup.classList.add("show");
}

function closeCluePopup() {
  document.getElementById("clue-popup").classList.remove("show");
  addDialogue("‚ú¶ Evidence added!", 'clue');
}

function updateSidebar() {
  const invList = document.getElementById("inventory-list");
  invList.innerHTML = "";
  const count = Object.keys(clueInventory).length;
  document.querySelector(".evidence-count").innerText = `(${count})`;
  if (count === 0) invList.innerHTML = "<p style='text-align:center;color:var(--text-dim);font-size:11px;'>No evidence yet...</p>";
  else Object.values(clueInventory).forEach(c => {
    const div = document.createElement("div");
    div.className = "clue-item";
    div.innerHTML = `<div class="clue-icon">${c.icon}</div><div class="clue-text">${c.text}</div>`;
    invList.appendChild(div);
  });

  const susList = document.getElementById("suspects-list");
  susList.innerHTML = "";
  Object.entries(SUSPECTS).forEach(([k, v]) => {
    const card = document.createElement("div");
    card.className = "suspect-card";
    card.onclick = () => startInterrogation(k);
    card.innerHTML = `<div class="suspect-portrait">${v.portrait}</div><div class="suspect-name">${v.name}</div><div class="suspect-role">${v.role}</div>`;
    susList.appendChild(card);
  });
}

function showSuspectsInRoom() {
  const here = Object.keys(SUSPECTS).filter(s => SUSPECTS[s].room === currentRoom);
  if (here.length === 0) { addDialogue("No suspects here."); return; }
  if (here.length === 1) startInterrogation(here[0]);
}

function startInterrogation(suspect) {
  if (SUSPECTS[suspect].room !== currentRoom) { addDialogue("Not in this room."); return; }
  const modal = document.getElementById("interrogation-modal");
  document.getElementById("interrog-portrait").innerText = SUSPECTS[suspect].portrait;
  document.getElementById("interrog-name").innerText = SUSPECTS[suspect].name;
  document.getElementById("interrog-role").innerText = SUSPECTS[suspect].role;
  const qList = document.getElementById("question-list");
  qList.innerHTML = "";
  const qs = ["Where were you?", "Alibi?", "How felt about victim?", "See anything?", "Relationship?", "Financial troubles?"];
  qs.forEach((q, i) => {
    const btn = document.createElement("button");
    btn.className = "question-btn";
    btn.innerText = q;
    btn.onclick = () => askQuestion(suspect, i);
    qList.appendChild(btn);
  });
  document.getElementById("response-box").innerText = "Ask a question...";
  modal.style.display = "block";
}

function askQuestion(suspect, idx) {
  const isKiller = suspect === MURDER_SOLUTION.killer;
  const responses = {
    0: isKiller ? "I was around... can't remember exactly." : `I was in ${SUSPECTS[suspect].room}.`,
    1: isKiller ? "Not really..." : "Yes, people saw me.",
    2: isKiller ? "We had issues." : "Professional.",
    3: isKiller ? "Nothing." : "Seemed normal.",
    4: isKiller ? "Complex." : "Business only.",
    5: isKiller ? "I'm fine." : "No troubles."
  };
  document.getElementById("response-box").innerHTML = `<strong>${SUSPECTS[suspect].name}:</strong><br>"${responses[idx]}"`;
  addDialogue(`Asked: "${["Where were you?", "Alibi?", "Feelings?", "Suspicious activity?", "Relationship?", "Financial issues?"][idx]}"`);
}

function closeInterrogationModal() { document.getElementById("interrogation-modal").style.display = "none"; }

function openAutopsyReport() {
  const data = AUTOPSY_DATA[MURDER_SOLUTION.weapon];
  document.getElementById("wound-analysis").innerText = data.wound;
  document.getElementById("time-of-death").innerText = data.time;
  document.getElementById("chemical-analysis").innerText = data.chemical;
  document.getElementById("additional-findings").innerText = data.findings;
  addDialogue("üìã Autopsy examined.", 'witness');
  document.getElementById("autopsy-modal").style.display = "block";
}

function closeAutopsyReport() { document.getElementById("autopsy-modal").style.display = "none"; }

function openAlibiBoard() {
  const board = document.getElementById("alibi-board-content");
  board.innerHTML = "";
  Object.entries(SUSPECTS).forEach(([k, v]) => {
    const card = document.createElement("div");
    card.className = "alibi-card";
    card.innerHTML = `<h4>${v.name}</h4><div class="alibi-item"><span class="${k === MURDER_SOLUTION.killer ? 'alibi-suspicious' : 'alibi-verified'}">Witness:</span> Says they were in ${v.room}</div>`;
    board.appendChild(card);
  });
  addDialogue("üìã Alibi board reviewed.", 'witness');
  document.getElementById("alibi-modal").style.display = "block";
}

function closeAlibiBoard() { document.getElementById("alibi-modal").style.display = "none"; }

function getHint() {
  if (hintsUsed >= 3) { addDialogue("All hints used.", 'contradiction'); return; }
  hintsUsed++;
  const hints = [`Motive: ${MURDER_SOLUTION.motive}`, `Weapon: ${MURDER_SOLUTION.weapon}`, `Killer: ${SUSPECTS[MURDER_SOLUTION.killer].name}`];
  addDialogue(`üí° Hint ${hintsUsed}/3: ${hints[hintsUsed-1]}`, 'witness');
}

function openAccusationModal() {
  document.getElementById("accusation-modal").style.display = "block";
  const susDiv = document.getElementById("acc-suspects");
  susDiv.innerHTML = Object.entries(SUSPECTS).map(([k, v]) => `<div class="selection-item" data-suspect="${k}" onclick="selectItem(this)"><div class="selection-icon">${v.portrait}</div><div class="selection-label">${v.name}</div></div>`).join("");
  const weapDiv = document.getElementById("acc-weapons");
  weapDiv.innerHTML = WEAPONS.map(w => `<div class="selection-item" data-weapon="${w.name}" onclick="selectItem(this)"><div class="selection-icon">${w.icon}</div><div class="selection-label">${w.label}</div></div>`).join("");
  const motiveDiv = document.getElementById("acc-motives");
  motiveDiv.innerHTML = MOTIVES.map(m => `<div class="selection-item" data-motive="${m.name}" onclick="selectItem(this)"><div class="selection-icon">${m.icon}</div><div class="selection-label">${m.label}</div></div>`).join("");
}

function selectItem(el) {
  el.parentElement.querySelectorAll(".selection-item").forEach(i => i.classList.remove("selected"));
  el.classList.add("selected");
}

function closeAccusationModal() { document.getElementById("accusation-modal").style.display = "none"; }

function submitAccusation() {
  const sus = document.querySelector("#acc-suspects .selection-item.selected")?.dataset.suspect;
  const weap = document.querySelector("#acc-weapons .selection-item.selected")?.dataset.weapon;
  const mot = document.querySelector("#acc-motives .selection-item.selected")?.dataset.motive;
  if (!sus || !weap || !mot) { alert("Select all!"); return; }
  guessAttempts++;
  let correct = 0;
  if (sus === MURDER_SOLUTION.killer) { correct++; addDialogue("‚úì Correct suspect", 'clue'); } else addDialogue(`‚úó Wrong: ${SUSPECTS[sus].name}`, 'contradiction');
  if (weap === MURDER_SOLUTION.weapon) { correct++; addDialogue("‚úì Correct weapon", 'clue'); } else addDialogue("‚úó Wrong weapon", 'contradiction');
  if (mot === MURDER_SOLUTION.motive) { correct++; addDialogue("‚úì Correct motive", 'clue'); } else addDialogue("‚úó Wrong motive", 'contradiction');
  
  if (correct === 3) {
    addDialogue("üéâ CASE SOLVED!", 'clue');
    setTimeout(() => showVictoryScreen(), 1000);
  } else {
    addDialogue(`${correct}/3 correct. Attempts: ${3 - guessAttempts}`, 'contradiction');
    if (guessAttempts >= 3) setTimeout(() => showDefeatScreen(), 2000);
  }
  closeAccusationModal();
}

function showVictoryScreen() {
  const overlay = document.createElement("div");
  overlay.style.cssText = "position:fixed;inset:0;background:linear-gradient(135deg,rgba(45,125,45,0.95),rgba(20,80,20,0.95));display:flex;align-items:center;justify-content:center;z-index:999;backdrop-filter:blur(5px)";
  overlay.innerHTML = `<div style="text-align:center;max-width:700px;padding:40px;"><div style="font-size:72px;margin-bottom:20px;">üéâ</div><div style="font-family:'Cinzel',serif;font-size:48px;color:#d4af37;margin-bottom:20px;text-transform:uppercase;letter-spacing:4px;text-shadow:2px 2px 10px rgba(0,0,0,0.8);">CASE SOLVED</div><div style="font-size:20px;color:#e8e6e3;margin-bottom:30px;line-height:1.8;"><strong>Killer:</strong> ${SUSPECTS[MURDER_SOLUTION.killer].name}<br><strong>Weapon:</strong> ${MURDER_SOLUTION.weapon.toUpperCase()}<br><strong>Motive:</strong> ${MURDER_SOLUTION.motive.toUpperCase()}</div><div style="background:rgba(0,0,0,0.5);border:2px solid #d4af37;border-radius:10px;padding:20px;margin-bottom:20px;color:#e8e6e3;font-size:14px;line-height:1.6;">Your brilliant deduction has brought justice to Vale Mansion.</div><button onclick="location.reload()" style="padding:15px 40px;font-family:'Cinzel',serif;font-size:16px;background:rgba(212,175,55,0.9);color:#0f0f0f;border:2px solid #d4af37;border-radius:8px;cursor:pointer;font-weight:700;text-transform:uppercase;transition:all 0.3s ease;" onmouseover="this.style.background='rgba(212,175,55,1)';this.style.boxShadow='0 0 30px rgba(212,175,55,0.8)'" onmouseout="this.style.background='rgba(212,175,55,0.9)';this.style.boxShadow='none'">NEW INVESTIGATION</button></div>`;
  document.body.appendChild(overlay);
}

function showDefeatScreen() {
  const overlay = document.createElement("div");
  overlay.style.cssText = "position:fixed;inset:0;background:linear-gradient(135deg,rgba(139,0,0,0.95),rgba(70,0,0,0.95));display:flex;align-items:center;justify-content:center;z-index:999;backdrop-filter:blur(5px)";
  overlay.innerHTML = `<div style="text-align:center;max-width:700px;padding:40px;"><div style="font-size:72px;margin-bottom:20px;">üíÄ</div><div style="font-family:'Cinzel',serif;font-size:48px;color:#ff6b6b;margin-bottom:20px;text-transform:uppercase;letter-spacing:4px;text-shadow:2px 2px 10px rgba(0,0,0,0.8);">CASE FAILED</div><div style="font-size:20px;color:#e8e6e3;margin-bottom:30px;line-height:1.8;">Too many wrong accusations.<br>The killer escaped.</div><div style="background:rgba(0,0,0,0.5);border:2px solid #8b0000;border-radius:10px;padding:20px;margin-bottom:20px;color:#e8e6e3;font-size:14px;line-height:1.6;"><strong>The Truth:</strong><br>Killer: ${SUSPECTS[MURDER_SOLUTION.killer].name}<br>Weapon: ${MURDER_SOLUTION.weapon.toUpperCase()}<br>Motive: ${MURDER_SOLUTION.motive.toUpperCase()}</div><button onclick="location.reload()" style="padding:15px 40px;font-family:'Cinzel',serif;font-size:16px;background:rgba(139,0,0,0.9);color:#e8e6e3;border:2px solid #ff6b6b;border-radius:8px;cursor:pointer;font-weight:700;text-transform:uppercase;transition:all 0.3s ease;" onmouseover="this.style.background='rgba(139,0,0,1)';this.style.boxShadow='0 0 30px rgba(139,0,0,0.8)'" onmouseout="this.style.background='rgba(139,0,0,0.9)';this.style.boxShadow='none'">TRY AGAIN</button></div>`;
  document.body.appendChild(overlay);
}

function startGame() {
  document.getElementById("intro-screen").style.display = "none";
  document.getElementById("game-container").style.display = "flex";
  addDialogue("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
  addDialogue("üîç Investigation begins, Detective.");
  addDialogue("Reginald Vale lies dead. Six suspects.");
  addDialogue("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
  addDialogue("Explore ‚Ä¢ Puzzle ‚Ä¢ Interrogate ‚Ä¢ Solve");
  addDialogue("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
  showRoom();
}

window.onload = () => console.log("Vale Mansion ready.");
</script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vale Mansion Murder Mystery</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --primary-dark: #0f0f0f;
  --accent-gold: #d4af37;
  --accent-blood: #8b0000;
  --text-light: #e8e6e3;
  --text-dim: #9a9a9a;
  --border-glow: rgba(212, 175, 55, 0.3);
}

body { 
  font-family: 'Crimson Text', serif; 
  color: var(--text-light); 
  background: var(--primary-dark); 
  overflow: hidden; 
  height: 100vh; 
}

#game-container { 
  display: flex; 
  height: 100vh; 
  position: relative; 
}

#game-container::before { 
  content: ''; 
  position: absolute; 
  width: 100%; 
  height: 100%; 
  background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.4) 100%); 
  pointer-events: none; 
  z-index: 1; 
}

#sidebar { 
  width: 340px; 
  background: linear-gradient(180deg, rgba(20,20,20,0.98) 0%, rgba(10,10,10,0.98) 100%); 
  border-right: 2px solid var(--accent-gold); 
  box-shadow: 4px 0 20px rgba(0,0,0,0.8); 
  overflow-y: auto; 
  z-index: 10; 
  display: flex; 
  flex-direction: column; 
}

#sidebar::-webkit-scrollbar { width: 8px; }
#sidebar::-webkit-scrollbar-thumb { background: var(--accent-gold); border-radius: 4px; }

.mansion-header { 
  background: linear-gradient(180deg, var(--accent-blood) 0%, #4a0000 100%); 
  padding: 25px 20px; 
  text-align: center; 
  border-bottom: 3px solid var(--accent-gold); 
}

.mansion-header h1 { 
  font-family: 'Cinzel', serif; 
  font-size: 24px; 
  font-weight: 700; 
  letter-spacing: 3px; 
  text-transform: uppercase; 
  margin-bottom: 8px; 
  color: var(--accent-gold); 
}

.sidebar-section { 
  margin: 20px 15px; 
  padding: 15px; 
  background: rgba(30,30,30,0.6); 
  border: 1px solid rgba(212, 175, 55, 0.2); 
  border-radius: 8px; 
}

.sidebar-section h3 { 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  font-weight: 600; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 2px; 
  margin-bottom: 12px; 
  border-bottom: 1px solid rgba(212, 175, 55, 0.3); 
  padding-bottom: 8px; 
}

.clue-item { 
  display: flex; 
  align-items: center; 
  margin: 8px 0; 
  padding: 8px; 
  background: rgba(20,20,20,0.8); 
  border-left: 3px solid var(--accent-gold); 
  border-radius: 4px; 
  font-size: 12px; 
}

.clue-icon { 
  margin-right: 8px; 
  font-size: 16px; 
  flex-shrink: 0; 
}

.clue-text { 
  color: var(--text-dim); 
}

.suspects-grid { 
  display: grid; 
  grid-template-columns: repeat(2, 1fr); 
  gap: 8px; 
}

.suspect-card { 
  background: rgba(20,20,20,0.9); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 8px; 
  padding: 10px; 
  text-align: center; 
  cursor: pointer; 
  transition: all 0.3s ease; 
}

.suspect-card:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 15px var(--border-glow); 
}

.suspect-portrait { 
  width: 50px; 
  height: 50px; 
  border-radius: 50%; 
  border: 2px solid var(--accent-gold); 
  margin: 0 auto 8px; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 28px; 
}

.suspect-name { 
  font-family: 'Cinzel', serif; 
  font-size: 10px; 
  font-weight: 600; 
  color: var(--accent-gold); 
  margin-bottom: 2px; 
}

.suspect-role { 
  font-size: 9px; 
  color: var(--text-dim); 
  font-style: italic; 
}

.room-buttons { 
  display: grid; 
  grid-template-columns: repeat(2, 1fr); 
  gap: 8px; 
}

.room-btn, .action-btn { 
  padding: 11px; 
  background: rgba(40,40,40,0.9); 
  color: var(--text-light); 
  border: 1px solid rgba(212, 175, 55, 0.3); 
  border-radius: 6px; 
  font-family: 'Crimson Text', serif; 
  font-size: 12px; 
  font-weight: 600; 
  cursor: pointer; 
  transition: all 0.3s ease; 
  text-transform: uppercase; 
}

.room-btn:hover, .action-btn:hover { 
  background: rgba(60,60,60,0.9); 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 15px var(--border-glow); 
}

.action-btn { 
  grid-column: span 2; 
  background: linear-gradient(180deg, rgba(139,0,0,0.3) 0%, rgba(70,0,0,0.3) 100%); 
}

#main-panel { 
  flex: 1; 
  position: relative; 
  background-size: cover; 
  background-position: center; 
  overflow: hidden; 
}

#main-panel::after { 
  content: ''; 
  position: absolute; 
  inset: 0; 
  background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.7) 100%); 
  pointer-events: none; 
}

.room-header { 
  position: absolute; 
  top: 30px; 
  left: 50%; 
  transform: translateX(-50%); 
  z-index: 5; 
  background: rgba(10,10,10,0.85); 
  padding: 15px 40px; 
  border: 2px solid var(--accent-gold); 
  border-radius: 10px; 
}

.room-header h2 { 
  font-family: 'Cinzel', serif; 
  font-size: 28px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 4px; 
}

#room-items { 
  position: absolute; 
  bottom: 240px; 
  left: 50%; 
  transform: translateX(-50%); 
  display: flex; 
  gap: 15px; 
  z-index: 5; 
  max-width: 90%; 
  flex-wrap: wrap; 
  justify-content: center; 
  padding: 20px; 
}

.item-card { 
  background: rgba(10,10,10,0.9); 
  border: 2px solid rgba(212, 175, 55, 0.4); 
  border-radius: 12px; 
  padding: 15px; 
  cursor: pointer; 
  transition: all 0.4s ease; 
  box-shadow: 0 4px 15px rgba(0,0,0,0.7); 
  min-width: 100px; 
  max-width: 120px; 
  animation: itemFadeIn 0.6s ease backwards; 
}

@keyframes itemFadeIn { 
  from { opacity: 0; transform: translateY(20px) scale(0.9); } 
  to { opacity: 1; transform: translateY(0) scale(1); } 
}

.item-card:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 25px var(--border-glow); 
  transform: translateY(-8px) scale(1.05); 
}

.item-icon { 
  font-size: 48px; 
  margin-bottom: 8px; 
}

.item-label { 
  font-family: 'Cinzel', serif; 
  font-size: 12px; 
  color: var(--accent-gold); 
  text-align: center; 
  text-transform: uppercase; 
}

#dialogue-box { 
  position: absolute; 
  bottom: 20px; 
  left: 20px; 
  right: 20px; 
  max-height: 180px; 
  background: rgba(10,10,10,0.95); 
  border: 2px solid var(--accent-gold); 
  border-radius: 12px; 
  padding: 20px; 
  overflow-y: auto; 
  font-size: 13px; 
  z-index: 5; 
}

#dialogue-box::-webkit-scrollbar-thumb { 
  background: var(--accent-gold); 
}

.dialogue-line { 
  margin-bottom: 10px; 
  padding-left: 20px; 
  position: relative; 
}

.dialogue-line::before { 
  content: '‚ñ∫'; 
  position: absolute; 
  left: 0; 
  color: var(--accent-gold); 
}

.clue-found { 
  color: var(--accent-gold); 
  font-weight: 600; 
}

.witness-note { 
  color: #7dd3fc; 
  font-weight: 600; 
}

.contradiction-note { 
  color: #ff6b6b; 
  font-weight: 600; 
}

.modal { 
  display: none; 
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%); 
  width: 600px; 
  max-width: 90%; 
  max-height: 90vh; 
  background: linear-gradient(180deg, rgba(20,20,20,0.98) 0%, rgba(10,10,10,0.98) 100%); 
  border: 3px solid var(--accent-gold); 
  border-radius: 15px; 
  padding: 30px; 
  z-index: 100; 
  box-shadow: 0 0 50px rgba(0,0,0,0.9); 
  overflow-y: auto; 
}

.modal h2 { 
  font-family: 'Cinzel', serif; 
  font-size: 26px; 
  color: var(--accent-gold); 
  text-align: center; 
  text-transform: uppercase; 
  letter-spacing: 3px; 
  margin-bottom: 25px; 
}

.modal h3 { 
  font-family: 'Cinzel', serif; 
  font-size: 16px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 2px; 
  margin-bottom: 15px; 
  margin-top: 15px; 
}

.selection-grid { 
  display: grid; 
  grid-template-columns: repeat(3, 1fr); 
  gap: 12px; 
}

.selection-item { 
  background: rgba(30,30,30,0.8); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 10px; 
  padding: 15px; 
  cursor: pointer; 
  text-align: center; 
  transition: all 0.3s ease; 
  position: relative; 
}

.selection-item:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 20px var(--border-glow); 
  transform: scale(1.05); 
}

.selection-item.selected { 
  border-color: var(--accent-gold); 
  background: rgba(212,175,55,0.2); 
}

.selection-item.selected::after { 
  content: '‚úì'; 
  position: absolute; 
  top: 5px; 
  right: 5px; 
  color: var(--accent-gold); 
  font-size: 20px; 
}

.selection-icon { 
  font-size: 40px; 
  margin-bottom: 8px; 
}

.selection-label { 
  font-size: 12px; 
  color: var(--text-light); 
  text-transform: uppercase; 
}

.modal-buttons { 
  display: flex; 
  gap: 15px; 
  margin-top: 25px; 
}

.modal-btn { 
  flex: 1; 
  padding: 15px; 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  font-weight: 600; 
  text-transform: uppercase; 
  border: 2px solid var(--accent-gold); 
  border-radius: 8px; 
  cursor: pointer; 
  transition: all 0.3s ease; 
}

.modal-btn-primary { 
  background: rgba(139,0,0,0.8); 
  color: var(--text-light); 
}

.modal-btn-primary:hover { 
  background: rgba(139,0,0,1); 
  box-shadow: 0 0 20px rgba(139,0,0,0.6); 
}

.modal-btn-secondary { 
  background: rgba(40,40,40,0.8); 
  color: var(--text-light); 
}

.modal-btn-secondary:hover { 
  background: rgba(60,60,60,0.9); 
}

.clue-popup { 
  display: none; 
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%) scale(0.8); 
  background: linear-gradient(180deg, rgba(20,20,20,0.98) 0%, rgba(10,10,10,0.98) 100%); 
  border: 3px solid var(--accent-gold); 
  border-radius: 15px; 
  padding: 30px; 
  max-width: 500px; 
  z-index: 150; 
  box-shadow: 0 0 50px rgba(212,175,55,0.6); 
  opacity: 0; 
  pointer-events: none; 
  transition: all 0.5s ease; 
}

.clue-popup.show { 
  opacity: 1; 
  display: block; 
  transform: translate(-50%, -50%) scale(1); 
  pointer-events: all; 
}

.clue-popup-icon { 
  font-size: 60px; 
  margin-bottom: 15px; 
  text-align: center;
}

.clue-popup-title { 
  font-family: 'Cinzel', serif; 
  font-size: 24px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 3px; 
  margin-bottom: 10px; 
  text-align: center;
}

.clue-popup-description { 
  font-size: 16px; 
  line-height: 1.8; 
  color: var(--text-light); 
  margin-bottom: 20px; 
  padding: 15px; 
  background: rgba(30,30,30,0.8); 
  border-left: 4px solid var(--accent-gold); 
  border-radius: 5px; 
}

.clue-popup-btn { 
  width: 100%; 
  padding: 15px; 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  font-weight: 600; 
  text-transform: uppercase; 
  background: rgba(139,0,0,0.8); 
  color: var(--text-light); 
  border: 2px solid var(--accent-gold); 
  border-radius: 8px; 
  cursor: pointer; 
}

.clue-popup-btn:hover { 
  background: rgba(139,0,0,1); 
}

.interrogation-header { 
  text-align: center; 
  margin-bottom: 25px; 
}

.interrogation-portrait { 
  width: 100px; 
  height: 100px; 
  border-radius: 50%; 
  border: 3px solid var(--accent-gold); 
  margin: 0 auto 15px; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 60px; 
  background: rgba(30,30,30,0.8); 
}

.interrogation-name { 
  font-family: 'Cinzel', serif; 
  font-size: 22px; 
  color: var(--accent-gold); 
  margin-bottom: 5px; 
}

.interrogation-role { 
  font-size: 14px; 
  color: var(--text-dim); 
  font-style: italic; 
}

.question-btn { 
  width: 100%; 
  padding: 15px; 
  margin-bottom: 10px; 
  background: rgba(30,30,30,0.8); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 8px; 
  color: var(--text-light); 
  font-family: 'Crimson Text', serif; 
  font-size: 14px; 
  text-align: left; 
  cursor: pointer; 
  transition: all 0.3s ease; 
}

.question-btn:hover { 
  background: rgba(40,40,40,0.9); 
  border-color: var(--accent-gold); 
}

.response-box { 
  margin: 20px 0; 
  padding: 15px; 
  background: rgba(10,10,10,0.9); 
  border-left: 4px solid var(--accent-gold); 
  border-radius: 6px; 
  min-height: 60px; 
  font-style: italic; 
  color: var(--text-dim); 
  max-height: 150px; 
  overflow-y: auto; 
}

.autopsy-section { 
  background: rgba(30,30,30,0.8); 
  border-left: 4px solid var(--accent-blood); 
  padding: 15px; 
  margin-bottom: 15px; 
  border-radius: 8px; 
}

.autopsy-section h4 { 
  color: var(--accent-blood); 
  font-family: 'Cinzel', serif; 
  font-size: 14px; 
  margin-bottom: 10px; 
  text-transform: uppercase; 
}

.autopsy-content { 
  font-size: 13px; 
  line-height: 1.6; 
  color: var(--text-light); 
}

.alibi-card { 
  background: rgba(30,30,30,0.8); 
  border: 2px solid rgba(212, 175, 55, 0.2); 
  border-radius: 10px; 
  padding: 15px; 
  transition: all 0.3s ease; 
  margin-bottom: 15px; 
  cursor: pointer; 
}

.alibi-card:hover { 
  border-color: var(--accent-gold); 
  box-shadow: 0 0 15px var(--border-glow); 
}

.alibi-card h4 { 
  color: var(--accent-gold); 
  font-family: 'Cinzel', serif; 
  margin-bottom: 8px; 
  font-size: 14px; 
}

.alibi-item { 
  font-size: 12px; 
  color: var(--text-dim); 
  margin: 5px 0; 
}

.alibi-verified { 
  color: #2d7d2d; 
  font-weight: 600; 
}

.alibi-suspicious { 
  color: #ff6b6b; 
  font-weight: 600; 
}

.intro-screen { 
  position: fixed; 
  inset: 0; 
  background: linear-gradient(180deg, #0a0a0a 0%, #1a1a1a 100%); 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  justify-content: center; 
  z-index: 1000; 
  padding: 40px; 
  overflow-y: auto; 
}

.intro-content { 
  max-width: 800px; 
  text-align: center; 
}

.intro-title { 
  font-family: 'Cinzel', serif; 
  font-size: 56px; 
  color: var(--accent-gold); 
  text-transform: uppercase; 
  letter-spacing: 8px; 
  margin-bottom: 15px; 
  text-shadow: 0 0 30px var(--accent-gold);
}

.intro-subtitle { 
  font-size: 20px; 
  color: var(--accent-blood); 
  font-style: italic; 
  margin-bottom: 40px; 
}

.intro-story { 
  background: rgba(20,20,20,0.8); 
  border: 2px solid var(--accent-gold); 
  border-radius: 15px; 
  padding: 30px; 
  margin-bottom: 40px; 
}

.intro-story h2 { 
  font-family: 'Cinzel', serif; 
  font-size: 24px; 
  color: var(--accent-gold); 
  margin-bottom: 20px; 
  text-transform: uppercase; 
}

.intro-story p { 
  font-size: 16px; 
  line-height: 1.8; 
  color: var(--text-light); 
  margin-bottom: 15px; 
  text-align: left; 
}

.victim-box { 
  background: rgba(139,0,0,0.2); 
  border-left: 4px solid var(--accent-blood); 
  padding: 15px; 
  margin: 20px 0; 
  border-radius: 5px; 
}

.start-button { 
  padding: 20px 60px; 
  font-family: 'Cinzel', serif; 
  font-size: 20px; 
  font-weight: 700; 
  text-transform: uppercase; 
  background: rgba(139,0,0,0.9); 
  color: var(--text-light); 
  border: 3px solid var(--accent-gold); 
  border-radius: 10px; 
  cursor: pointer; 
  transition: all 0.4s ease; 
}

.start-button:hover { 
  background: rgba(139,0,0,1); 
  box-shadow: 0 0 50px rgba(212,175,55,0.8); 
  transform: translateY(-5px); 
}
</style>
</head>
<body>

<div id="intro-screen" class="intro-screen">
  <div class="intro-content">
    <div class="intro-title">Vale Mansion</div>
    <div class="intro-subtitle">A Murder Most Foul</div>
    
    <div class="intro-story">
      <h2>The Case</h2>
      <p>On a cold October evening in 1924, Vale Mansion was shaken by a terrible crime. The renowned industrialist <strong>REGINALD VALE</strong> was found dead in his study.</p>
      <div class="victim-box">
        <strong>VICTIM:</strong> Reginald Vale, aged 58<br>
        <strong>TIME:</strong> Between 8:00 PM and 10:00 PM<br>
        <strong>LOCATION:</strong> The Study
      </div>
      <p>Six individuals were present. Each has secrets. Your task: identify the killer, weapon, and motive through logical deduction and puzzle solving.</p>
    </div>
    
    <button class="start-button" onclick="startGame()">BEGIN INVESTIGATION</button>
  </div>
</div>

<div id="game-container" style="display:none;">
  <div id="sidebar">
    <div class="mansion-header">
      <h1>Vale Mansion</h1>
    </div>
    
    <div class="sidebar-section">
      <h3>üìã Evidence <span class="evidence-count">(0)</span></h3>
      <div id="inventory-list"></div>
    </div>
    
    <div class="sidebar-section">
      <h3>üîç Suspects</h3>
      <div id="suspects-list" class="suspects-grid"></div>
    </div>
    
    <div class="sidebar-section">
      <h3>üö™ Rooms</h3>
      <div class="room-buttons">
        <button class="room-btn" onclick="moveRoom('study')">Study</button>
        <button class="room-btn" onclick="moveRoom('kitchen')">Kitchen</button>
        <button class="room-btn" onclick="moveRoom('conservatory')">Conservatory</button>
        <button class="room-btn" onclick="moveRoom('office')">Office</button>
        <button class="room-btn" onclick="moveRoom('guest')">Guest</button>
        <button class="room-btn" onclick="moveRoom('library')">Library</button>
      </div>
    </div>
    
    <div class="sidebar-section">
      <h3>‚ö° Actions</h3>
      <button class="action-btn" onclick="showSuspectsInRoom()">üó£Ô∏è Interrogate</button>
      <button class="action-btn" onclick="openAlibiBoard()">üìã Alibis</button>
      <button class="action-btn" onclick="openAutopsyReport()">‚öïÔ∏è Autopsy</button>
      <button class="action-btn" onclick="getHint()">üí° Hint</button>
      <button class="action-btn" onclick="openAccusationModal()">‚öñÔ∏è Accuse</button>
    </div>
  </div>
  
  <div id="main-panel">
    <div class="room-header">
      <h2 id="room-title">Study</h2>
    </div>
    <div id="room-items"></div>
    <div id="dialogue-box"></div>
  </div>
</div>

<div id="clue-popup" class="clue-popup">
  <div class="clue-popup-icon" id="clue-popup-icon">üîç</div>
  <div class="clue-popup-title">Evidence Found!</div>
  <div class="clue-popup-description" id="clue-popup-description"></div>
  <button class="clue-popup-btn" onclick="closeCluePopup()">Add to Evidence</button>
</div>

<div id="accusation-modal" class="modal">
  <h2>Make Your Accusation</h2>
  <div class="modal-section">
    <h3>Select Suspect</h3>
    <div id="acc-suspects" class="selection-grid"></div>
  </div>
  <div class="modal-section">
    <h3>Select Weapon</h3>
    <div id="acc-weapons" class="selection-grid"></div>
  </div>
  <div class="modal-section">
    <h3>Select Motive</h3>
    <div id="acc-motives" class="selection-grid"></div>
  </div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-primary" onclick="submitAccusation()">Submit</button>
    <button class="modal-btn modal-btn-secondary" onclick="closeAccusationModal()">Cancel</button>
  </div>
</div>

<div id="interrogation-modal" class="modal">
  <div class="interrogation-header">
    <div class="interrogation-portrait" id="interrog-portrait"></div>
    <div class="interrogation-name" id="interrog-name"></div>
    <div class="interrogation-role" id="interrog-role"></div>
  </div>
  <div id="question-list"></div>
  <div class="response-box" id="response-box">Ask a question to begin...</div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-secondary" onclick="closeInterrogationModal()">End</button>
  </div>
</div>

<div id="autopsy-modal" class="modal">
  <h2>üî¨ Autopsy Report</h2>
  <div class="autopsy-section">
    <h4>Wound Analysis</h4>
    <div class="autopsy-content" id="wound-analysis"></div>
  </div>
  <div class="autopsy-section">
    <h4>Time of Death</h4>
    <div class="autopsy-content" id="time-of-death"></div>
  </div>
  <div class="autopsy-section">
    <h4>Chemical Analysis</h4>
    <div class="autopsy-content" id="chemical-analysis"></div>
  </div>
  <div class="autopsy-section">
    <h4>Findings</h4>
    <div class="autopsy-content" id="additional-findings"></div>
  </div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-secondary" onclick="closeAutopsyReport()">Close</button>
  </div>
</div>

<div id="alibi-modal" class="modal">
  <h2>üìã Alibi Board</h2>
  <div id="alibi-board-content"></div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-secondary" onclick="closeAlibiBoard()">Close</button>
  </div>
</div>

<script>
const SUSPECTS = {
  trevor: {name: "TREVOR VALE", role: "Brother", room: "kitchen", portrait: "üë®‚Äçüíº", bg: "Desperate for inheritance. Written out of will."},
  emma: {name: "EMMA HARROW", role: "Assistant", room: "conservatory", portrait: "üë©‚Äçüíº", bg: "Personal assistant. Knows all secrets."},
  lyle: {name: "DR. ARTHUR LYLE", role: "Physician", room: "guest", portrait: "üë®‚Äç‚öïÔ∏è", bg: "Family doctor. Owed Reginald money."},
  marcus: {name: "MARCUS FINCH", role: "Courier", room: "office", portrait: "üë®‚Äç‚úàÔ∏è", bg: "Delivered documents. Transporting valuables."},
  vanessa: {name: "VANESSA CROSS", role: "Neighbor", room: "library", portrait: "üë©‚Äçü¶∞", bg: "Property dispute. Bitter relationship."},
  gerald: {name: "GERALD STONE", role: "Lawyer", room: "study", portrait: "üë®‚Äç‚öñÔ∏è", bg: "Changed will recently. Legal advisor."}
};

const WEAPONS = [{name: "knife", icon: "üî™", label: "Knife"}, {name: "poison", icon: "‚ò†Ô∏è", label: "Poison"}, {name: "rope", icon: "ü™¢", label: "Rope"}, {name: "candlestick", icon: "üïØÔ∏è", label: "Candlestick"}, {name: "gun", icon: "üî´", label: "Gun"}];

const MOTIVES = [{name: "money", icon: "üí∞", label: "Money"}, {name: "revenge", icon: "‚öîÔ∏è", label: "Revenge"}, {name: "jealousy", icon: "üíî", label: "Jealousy"}, {name: "coverup", icon: "ü§´", label: "Cover-up"}, {name: "greed", icon: "üíé", label: "Greed"}];

const AUTOPSY_DATA = {
  knife: {wound: "Long incision, sharp edges. Defensive wounds on hands.", time: "8:45-9:15 PM", chemical: "Iron traces. No toxins.", findings: "Severe struggle. Victim fought back."},
  poison: {wound: "No external wounds. Blue lips, constricted pupils.", time: "Around 9:30 PM", chemical: "Cyanide detected. Bitter almond odor.", findings: "Foam around mouth. No struggle."},
  rope: {wound: "Ligature marks around neck. Severe bruising.", time: "Around 9:00 PM", chemical: "Rope fibers under fingernails.", findings: "Prolonged struggle evidence."},
  candlestick: {wound: "Blunt force trauma. Fractured skull.", time: "Around 8:50 PM", chemical: "No toxins. Blood type matches.", findings: "Silver dust in wound. Single blow."},
  gun: {wound: "Gunshot to chest. Bullet near heart.", time: "Around 8:30 PM", chemical: "Gunpowder residue present.", findings: "Close range. Silent killer."}
};

let MURDER_SOLUTION = (() => {
  const suspects = Object.keys(SUSPECTS);
  const weaponNames = WEAPONS.map(w => w.name);
  const motiveNames = MOTIVES.map(m => m.name);
  return {killer: suspects[Math.floor(Math.random() * suspects.length)], weapon: weaponNames[Math.floor(Math.random() * weaponNames.length)], motive: motiveNames[Math.floor(Math.random() * motiveNames.length)]};
})();

let currentRoom = "study", clueInventory = {}, guessAttempts = 0, hintsUsed = 0;

function addDialogue(text, type = 'normal') {
  const box = document.getElementById("dialogue-box");
  const line = document.createElement("div");
  line.className = "dialogue-line";
  if (type === 'clue') line.innerHTML = `<span class="clue-found">${text}</span>`;
  else if (type === 'witness') line.innerHTML = `<span class="witness-note">${text}</span>`;
  else if (type === 'contradiction') line.innerHTML = `<span class="contradiction-note">${text}</span>`;
  else line.innerText = text;
  box.appendChild(line);
  box.scrollTop = box.scrollHeight;
}

function showRoom() {
  document.getElementById("room-title").innerText = currentRoom.charAt(0).toUpperCase() + currentRoom.slice(1);
  const container = document.getElementById("room-items");
  container.innerHTML = "";
  const items = generateRoomItems(currentRoom);
  items.forEach((item, i) => {
    const card = document.createElement("div");
    card.className = "item-card";
    card.style.animationDelay = (i * 0.1) + "s";
    card.innerHTML = `<div class="item-icon">${item.icon}</div><div class="item-label">${item.name}</div>`;
    card.onclick = () => inspectItem(item);
    container.appendChild(card);
  });
  updateSidebar();
}

function generateRoomItems(room) {
  const killer = MURDER_SOLUTION.killer;
  const weapon = MURDER_SOLUTION.weapon;
  const motive = MURDER_SOLUTION.motive;
  const items = {
    study: [
      {id: "letter", name: "Locked Drawer", icon: "üîí", text: `Letter to ${SUSPECTS[killer].name} about ${motive}.`, puzzle: true},
      {id: "phone", name: "Phone Log", icon: "‚òéÔ∏è", text: "Call to suspect at 8:45 PM.", puzzle: false},
      {id: "blood", name: "Blood Stains", icon: "ü©∏", text: "Fresh blood on desk.", puzzle: false}
    ],
    kitchen: [
      {id: "weapon", name: weapon === "knife" ? "Missing Knife" : "Evidence", icon: weapon === "knife" ? "üî™" : "üì¶", text: `${weapon} evidence found.`, puzzle: true},
      {id: "note", name: "Handwritten Note", icon: "üìù", text: `${SUSPECTS[killer].name}'s note about ${motive}.`, puzzle: false},
      {id: "cleanup", name: "Cleanup Traces", icon: "üö∞", text: "Blood in sink. Recently cleaned.", puzzle: false}
    ],
    conservatory: [
      {id: "diary", name: "Diary Entry", icon: "üìî", text: `Witness saw ${SUSPECTS[killer].name} acting suspicious.`, puzzle: true},
      {id: "items", name: "Personal Items", icon: "‚òï", text: `${SUSPECTS[killer].name}'s belongings showing distress.`, puzzle: false},
      {id: "haste", name: "Haste Signs", icon: "üßµ", text: `Evidence of rushed departure.`, puzzle: false}
    ],
    office: [
      {id: "financial", name: "Safe Records", icon: "üîê", text: `${SUSPECTS[killer].name}'s motive: ${motive}.`, puzzle: true},
      {id: "will", name: "Will Changes", icon: "üìú", text: "Will changed today. Affects killer.", puzzle: false},
      {id: "valuables", name: "Valuables", icon: "üíé", text: "Large cash sum found.", puzzle: false}
    ],
    guest: [
      {id: "suitcase", name: "Packed Suitcase", icon: "üß≥", text: `${SUSPECTS[killer].name}'s hasty escape.`, puzzle: true},
      {id: "ticket", name: "Travel Booking", icon: "üé´", text: "Departure booked for same night.", puzzle: false},
      {id: "escape", name: "Escape Plan", icon: "üëú", text: "Premeditated escape evident.", puzzle: false}
    ],
    library: [
      {id: "message", name: "Hidden Message", icon: "üìö", text: `Book with coded ${weapon} reference.`, puzzle: true},
      {id: "contradiction", name: "Contradiction", icon: "üìÆ", text: `${SUSPECTS[killer].name}'s alibi contradicted.`, puzzle: false},
      {id: "link", name: "Murder Link", icon: "üîç", text: `Object linked to ${SUSPECTS[killer].name}.`, puzzle: false}
    ]
  };
  return items[room] || [];
}

function moveRoom(room) {
  currentRoom = room;
  addDialogue(`You move to the ${room}.`);
  showRoom();
}

function inspectItem(item) {
  addDialogue(`You examine ${item.name}...`);
  if (!clueInventory[item.id]) {
    if (item.puzzle) {
      const puzzle = {
        study: {q: "Code: Month(10) + Year(24) + Suspects(06)", a: "102406"},
        kitchen: {q: `What's missing? Answer: ${MURDER_SOLUTION.weapon}`, a: MURDER_SOLUTION.weapon},
        conservatory: {q: `Diary: Saw ___ looking ___. Answer: ${SUSPECTS[MURDER_SOLUTION.killer].name.split(' ')[0].toLowerCase()}`, a: SUSPECTS[MURDER_SOLUTION.killer].name.split(' ')[0].toLowerCase()},
        office: {q: "Safe pattern O-4-7-?. Answer: 3", a: "3"},
        guest: {q: "Days before? Today=15, Ticket=16. Answer: D1", a: "d1"},
        library: {q: `Message applies to initials. Answer: ${MURDER_SOLUTION.killer.charAt(0).toUpperCase()}`, a: MURDER_SOLUTION.killer.charAt(0).toLowerCase()}
      }[currentRoom];
      const answer = prompt(puzzle.q);
      if (answer && answer.toLowerCase() === puzzle.a.toLowerCase()) {
        clueInventory[item.id] = item;
        addDialogue("‚úì Puzzle solved!", 'clue');
        showCluePopup(item);
        updateSidebar();
      } else if (answer) {
        addDialogue("‚úó Incorrect.", 'contradiction');
      }
    } else {
      clueInventory[item.id] = item;
      showCluePopup(item);
      updateSidebar();
    }
  } else {
    addDialogue("Already found this clue.");
  }
}

function showCluePopup(item) {
  const popup = document.getElementById("clue-popup");
  document.getElementById("clue-popup-icon").innerText = item.icon;
  document.getElementById("clue-popup-description").innerText = item.text;
  popup.classList.add("show");
}

function closeCluePopup() {
  document.getElementById("clue-popup").classList.remove("show");
  addDialogue("‚ú¶ Evidence added!", 'clue');
}

function updateSidebar() {
  const invList = document.getElementById("inventory-list");
  invList.innerHTML = "";
  const count = Object.keys(clueInventory).length;
  document.querySelector(".evidence-count").innerText = `(${count})`;
  if (count === 0) invList.innerHTML = "<p style='text-align:center;color:var(--text-dim);font-size:11px;'>No evidence yet...</p>";
  else Object.values(clueInventory).forEach(c => {
    const div = document.createElement("div");
    div.className = "clue-item";
    div.innerHTML = `<div class="clue-icon">${c.icon}</div><div class="clue-text">${c.text}</div>`;
    invList.appendChild(div);
  });

  const susList = document.getElementById("suspects-list");
  susList.innerHTML = "";
  Object.entries(SUSPECTS).forEach(([k, v]) => {
    const card = document.createElement("div");
    card.className = "suspect-card";
    card.onclick = () => startInterrogation(k);
    card.innerHTML = `<div class="suspect-portrait">${v.portrait}</div><div class="suspect-name">${v.name}</div><div class="suspect-role">${v.role}</div>`;
    susList.appendChild(card);
  });
}

function showSuspectsInRoom() {
  const here = Object.keys(SUSPECTS).filter(s => SUSPECTS[s].room === currentRoom);
  if (here.length === 0) { addDialogue("No suspects here."); return; }
  if (here.length === 1) startInterrogation(here[0]);
}

function startInterrogation(suspect) {
  if (SUSPECTS[suspect].room !== currentRoom) { addDialogue("Not in this room."); return; }
  const modal = document.getElementById("interrogation-modal");
  document.getElementById("interrog-portrait").innerText = SUSPECTS[suspect].portrait;
  document.getElementById("interrog-name").innerText = SUSPECTS[suspect].name;
  document.getElementById("interrog-role").innerText = SUSPECTS[suspect].role;
  const qList = document.getElementById("question-list");
  qList.innerHTML = "";
  const qs = ["Where were you?", "Alibi?", "How felt about victim?", "See anything?", "Relationship?", "Financial troubles?"];
  qs.forEach((q, i) => {
    const btn = document.createElement("button");
    btn.className = "question-btn";
    btn.innerText = q;
    btn.onclick = () => askQuestion(suspect, i);
    qList.appendChild(btn);
  });
  document.getElementById("response-box").innerText = "Ask a question...";
  modal.style.display = "block";
}

function askQuestion(suspect, idx) {
  const isKiller = suspect === MURDER_SOLUTION.killer;
  const responses = {
    0: isKiller ? "I was around... can't remember exactly." : `I was in ${SUSPECTS[suspect].room}.`,
    1: isKiller ? "Not really..." : "Yes, people saw me.",
    2: isKiller ? "We had issues." : "Professional.",
    3: isKiller ? "Nothing." : "Seemed normal.",
    4: isKiller ? "Complex." : "Business only.",
    5: isKiller ? "I'm fine." : "No troubles."
  };
  document.getElementById("response-box").innerHTML = `<strong>${SUSPECTS[suspect].name}:</strong><br>"${responses[idx]}"`;
  addDialogue(`Asked: "${["Where were you?", "Alibi?", "Feelings?", "Suspicious activity?", "Relationship?", "Financial issues?"][idx]}"`);
}

function closeInterrogationModal() { document.getElementById("interrogation-modal").style.display = "none"; }

function openAutopsyReport() {
  const data = AUTOPSY_DATA[MURDER_SOLUTION.weapon];
  document.getElementById("wound-analysis").innerText = data.wound;
  document.getElementById("time-of-death").innerText = data.time;
  document.getElementById("chemical-analysis").innerText = data.chemical;
  document.getElementById("additional-findings").innerText = data.findings;
  addDialogue("üìã Autopsy examined.", 'witness');
  document.getElementById("autopsy-modal").style.display = "block";
}

function closeAutopsyReport() { document.getElementById("autopsy-modal").style.display = "none"; }

function openAlibiBoard() {
  const board = document.getElementById("alibi-board-content");
  board.innerHTML = "";
  Object.entries(SUSPECTS).forEach(([k, v]) => {
    const card = document.createElement("div");
    card.className = "alibi-card";
    card.innerHTML = `<h4>${v.name}</h4><div class="alibi-item"><span class="${k === MURDER_SOLUTION.killer ? 'alibi-suspicious' : 'alibi-verified'}">Witness:</span> Says they were in ${v.room}</div>`;
    board.appendChild(card);
  });
  addDialogue("üìã Alibi board reviewed.", 'witness');
  document.getElementById("alibi-modal").style.display = "block";
}

function closeAlibiBoard() { document.getElementById("alibi-modal").style.display = "none"; }

function getHint() {
  if (hintsUsed >= 3) { addDialogue("All hints used.", 'contradiction'); return; }
  hintsUsed++;
  const hints = [`Motive: ${MURDER_SOLUTION.motive}`, `Weapon: ${MURDER_SOLUTION.weapon}`, `Killer: ${SUSPECTS[MURDER_SOLUTION.killer].name}`];
  addDialogue(`üí° Hint ${hintsUsed}/3: ${hints[hintsUsed-1]}`, 'witness');
}

function openAccusationModal() {
  document.getElementById("accusation-modal").style.display = "block";
  const susDiv = document.getElementById("acc-suspects");
  susDiv.innerHTML = Object.entries(SUSPECTS).map(([k, v]) => `<div class="selection-item" data-suspect="${k}" onclick="selectItem(this)"><div class="selection-icon">${v.portrait}</div><div class="selection-label">${v.name}</div></div>`).join("");
  const weapDiv = document.getElementById("acc-weapons");
  weapDiv.innerHTML = WEAPONS.map(w => `<div class="selection-item" data-weapon="${w.name}" onclick="selectItem(this)"><div class="selection-icon">${w.icon}</div><div class="selection-label">${w.label}</div></div>`).join("");
  const motiveDiv = document.getElementById("acc-motives");
  motiveDiv.innerHTML = MOTIVES.map(m => `<div class="selection-item" data-motive="${m.name}" onclick="selectItem(this)"><div class="selection-icon">${m.icon}</div><div class="selection-label">${m.label}</div></div>`).join("");
}

function selectItem(el) {
  el.parentElement.querySelectorAll(".selection-item").forEach(i => i.classList.remove("selected"));
  el.classList.add("selected");
}

function closeAccusationModal() { document.getElementById("accusation-modal").style.display = "none"; }

function submitAccusation() {
  const sus = document.querySelector("#acc-suspects .selection-item.selected")?.dataset.suspect;
  const weap = document.querySelector("#acc-weapons .selection-item.selected")?.dataset.weapon;
  const mot = document.querySelector("#acc-motives .selection-item.selected")?.dataset.motive;
  if (!sus || !weap || !mot) { alert("Select all!"); return; }
  guessAttempts++;
  let correct = 0;
  if (sus === MURDER_SOLUTION.killer) { correct++; addDialogue("‚úì Correct suspect", 'clue'); } else addDialogue(`‚úó Wrong: ${SUSPECTS[sus].name}`, 'contradiction');
  if (weap === MURDER_SOLUTION.weapon) { correct++; addDialogue("‚úì Correct weapon", 'clue'); } else addDialogue("‚úó Wrong weapon", 'contradiction');
  if (mot === MURDER_SOLUTION.motive) { correct++; addDialogue("‚úì Correct motive", 'clue'); } else addDialogue("‚úó Wrong motive", 'contradiction');
  
  if (correct === 3) {
    addDialogue("üéâ CASE SOLVED!", 'clue');
    setTimeout(() => showVictoryScreen(), 1000);
  } else {
    addDialogue(`${correct}/3 correct. Attempts: ${3 - guessAttempts}`, 'contradiction');
    if (guessAttempts >= 3) setTimeout(() => showDefeatScreen(), 2000);
  }
  closeAccusationModal();
}

function showVictoryScreen() {
  const overlay = document.createElement("div");
  overlay.style.cssText = "position:fixed;inset:0;background:linear-gradient(135deg,rgba(45,125,45,0.95),rgba(20,80,20,0.95));display:flex;align-items:center;justify-content:center;z-index:999;backdrop-filter:blur(5px)";
  overlay.innerHTML = `<div style="text-align:center;max-width:700px;padding:40px;"><div style="font-size:72px;margin-bottom:20px;">üéâ</div><div style="font-family:'Cinzel',serif;font-size:48px;color:#d4af37;margin-bottom:20px;text-transform:uppercase;letter-spacing:4px;text-shadow:2px 2px 10px rgba(0,0,0,0.8);">CASE SOLVED</div><div style="font-size:20px;color:#e8e6e3;margin-bottom:30px;line-height:1.8;"><strong>Killer:</strong> ${SUSPECTS[MURDER_SOLUTION.killer].name}<br><strong>Weapon:</strong> ${MURDER_SOLUTION.weapon.toUpperCase()}<br><strong>Motive:</strong> ${MURDER_SOLUTION.motive.toUpperCase()}</div><div style="background:rgba(0,0,0,0.5);border:2px solid #d4af37;border-radius:10px;padding:20px;margin-bottom:20px;color:#e8e6e3;font-size:14px;line-height:1.6;">Your brilliant deduction has brought justice to Vale Mansion.</div><button onclick="location.reload()" style="padding:15px 40px;font-family:'Cinzel',serif;font-size:16px;background:rgba(212,175,55,0.9);color:#0f0f0f;border:2px solid #d4af37;border-radius:8px;cursor:pointer;font-weight:700;text-transform:uppercase;transition:all 0.3s ease;" onmouseover="this.style.background='rgba(212,175,55,1)';this.style.boxShadow='0 0 30px rgba(212,175,55,0.8)'" onmouseout="this.style.background='rgba(212,175,55,0.9)';this.style.boxShadow='none'">NEW INVESTIGATION</button></div>`;
  document.body.appendChild(overlay);
}

function showDefeatScreen() {
  const overlay = document.createElement("div");
  overlay.style.cssText = "position:fixed;inset:0;background:linear-gradient(135deg,rgba(139,0,0,0.95),rgba(70,0,0,0.95));display:flex;align-items:center;justify-content:center;z-index:999;backdrop-filter:blur(5px)";
  overlay.innerHTML = `<div style="text-align:center;max-width:700px;padding:40px;"><div style="font-size:72px;margin-bottom:20px;">üíÄ</div><div style="font-family:'Cinzel',serif;font-size:48px;color:#ff6b6b;margin-bottom:20px;text-transform:uppercase;letter-spacing:4px;text-shadow:2px 2px 10px rgba(0,0,0,0.8);">CASE FAILED</div><div style="font-size:20px;color:#e8e6e3;margin-bottom:30px;line-height:1.8;">Too many wrong accusations.<br>The killer escaped.</div><div style="background:rgba(0,0,0,0.5);border:2px solid #8b0000;border-radius:10px;padding:20px;margin-bottom:20px;color:#e8e6e3;font-size:14px;line-height:1.6;"><strong>The Truth:</strong><br>Killer: ${SUSPECTS[MURDER_SOLUTION.killer].name}<br>Weapon: ${MURDER_SOLUTION.weapon.toUpperCase()}<br>Motive: ${MURDER_SOLUTION.motive.toUpperCase()}</div><button onclick="location.reload()" style="padding:15px 40px;font-family:'Cinzel',serif;font-size:16px;background:rgba(139,0,0,0.9);color:#e8e6e3;border:2px solid #ff6b6b;border-radius:8px;cursor:pointer;font-weight:700;text-transform:uppercase;transition:all 0.3s ease;" onmouseover="this.style.background='rgba(139,0,0,1)';this.style.boxShadow='0 0 30px rgba(139,0,0,0.8)'" onmouseout="this.style.background='rgba(139,0,0,0.9)';this.style.boxShadow='none'">TRY AGAIN</button></div>`;
  document.body.appendChild(overlay);
}

function startGame() {
  document.getElementById("intro-screen").style.display = "none";
  document.getElementById("game-container").style.display = "flex";
  addDialogue("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
  addDialogue("üîç Investigation begins, Detective.");
  addDialogue("Reginald Vale lies dead. Six suspects.");
  addDialogue("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
  addDialogue("Explore ‚Ä¢ Puzzle ‚Ä¢ Interrogate ‚Ä¢ Solve");
  addDialogue("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
  showRoom();
}

window.onload = () => console.log("Vale Mansion ready.");
</script>
</body>
</html>
